# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∫ –∑–∞–Ω—è—Ç–∏—é  ¬´Disaster recovery –∏ Keepalived¬ª ‚Äî –ö–æ–ª—ã–≤–∞–Ω–æ–≤ –ê–Ω—Ç–æ–Ω

---

## –ó–∞–¥–∞–Ω–∏–µ 1

–î–∞–Ω–∞ —Å—Ö–µ–º–∞ –¥–ª—è **Cisco Packet Tracer**, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–∞—è –≤ –ª–µ–∫—Ü–∏–∏.  
–ù–∞ –¥–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ `Gi0/1` (–¥–ª—è –Ω—É–ª–µ–≤–æ–π –≥—Ä—É–ø–ø—ã).  
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ `Gi0/0` (–¥–ª—è –ø–µ—Ä–≤–æ–π –≥—Ä—É–ø–ø—ã).  

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- —Ä–∞–∑–æ—Ä–≤–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –∫–∞–±–µ–ª–µ–π –º–µ–∂–¥—É –æ–¥–Ω–∏–º –∏–∑ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ –∏ `Switch0`;
- –∑–∞–ø—É—Å—Ç–∏—Ç–µ `ping` –º–µ–∂–¥—É `PC0` –∏ `Server0`.

–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:
- –ø–æ–ª—É—á–∏–≤—à—É—é—Å—è —Å—Ö–µ–º—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.pkt`;
- —Å–∫—Ä–∏–Ω—à–æ—Ç, –≥–¥–µ –≤–∏–¥–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞.

üìÅ [–°—Ö–µ–º–∞ –¥–ª—è Cisco Packet Tracer](1/zadanie1.pkt)

üì∑ –°–∫—Ä–∏–Ω—à–æ—Ç `show standby brief`:  
![—Å–∫—Ä–∏–Ω—à–æ—Ç show standby brief](img/1.png)

---

## –ó–∞–¥–∞–Ω–∏–µ 2

- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–≤–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã **Linux**;
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ—Ä–≤–∏—Å **Keepalived** –∫–∞–∫ –≤ –ª–µ–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞;
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª—é–±–æ–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `nginx` –∏–ª–∏ `simple python server`);
- –ù–∞–ø–∏—à–∏—Ç–µ **Bash-—Å–∫—Ä–∏–ø—Ç**, –∫–æ—Ç–æ—Ä—ã–π:
  - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞;
  - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `index.html` –≤ root-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞;
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Keepalived —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω:
  - –∑–∞–ø—É—Å–∫–∞–ª —Å–∫—Ä–∏–ø—Ç –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã;
  - –ø–µ—Ä–µ–Ω–æ—Å–∏–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π IP –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä, –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º, –æ—Ç–ª–∏—á–Ω—ã–º –æ—Ç 0 (–ø–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `index.html`);
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —ç—Ç–æ–≥–æ —Å–µ–∫—Ü–∏—é `vrrp_script`.

–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:
- –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è `bash`-—Å–∫—Ä–∏–ø—Ç;
- –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `keepalived`;
- —Å–∫—Ä–∏–Ω—à–æ—Ç —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–µ—Ä–µ–µ–∑–¥–∞ IP –ø—Ä–∏ –æ—à–∏–±–∫–µ.

üì∑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞ 80 `exit 1`:  
![–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞ 80](img/2.png)

üì∑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `index.html` `exit 2`:  
![–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è index.html](img/3.png)

üìÑ [–ü–æ–ª—É—á–∏–≤—à–∏–π—Å—è bash-—Å–∫—Ä–∏–ø—Ç](1/check_web.sh)  
üìÑ [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Keepalived](1/keepalived.conf)

---

## –ó–∞–¥–∞–Ω–∏–µ 3*

- –ò–∑—É—á–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **Keepalived**, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `vrrp_track_file`;
- –ù–∞–ø–∏—à–∏—Ç–µ **bash-—Å–∫—Ä–∏–ø—Ç**, –∫–æ—Ç–æ—Ä—ã–π:
  - –º–µ–Ω—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É;
  - (–º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ `cron` –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É);
  - —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ `Load average`;
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **Keepalived** –Ω–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞;
- –ù–∞–≥—Ä—É–∑–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –í–ú, –∫–æ—Ç–æ—Ä–∞—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `MASTER`, –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
  - —á—Ç–æ–±—ã —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –æ–Ω–∞ –ø–µ—Ä–µ—à–ª–∞ –≤ `SLAVE`;
  - —á—Ç–æ–±—ã IP –ø–µ—Ä–µ–µ—Ö–∞–ª –Ω–∞ –º–µ–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä;
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **Keepalived** –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º —Å–µ—Ä–≤–µ—Ä–µ;
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–æ—Ä–º—É–ª—É —Ç–∞–∫, —á—Ç–æ–±—ã IP –≤—Å–µ–≥–¥–∞ –±—ã–ª –Ω–∞ –Ω–∞–∏–º–µ–Ω–µ–µ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.

–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:
- –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è `bash`-—Å–∫—Ä–∏–ø—Ç;
- –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `keepalived`;
- —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ª–æ–≥–æ–≤ keepalived —Å —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö.

üìÑ [–ü–æ–ª—É—á–∏–≤—à–∏–π—Å—è bash-—Å–∫—Ä–∏–ø—Ç](1/calc_priority.sh)  
üìÑ [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Keepalived](1/keepalived_zadanie3.conf)
